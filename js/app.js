// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t)f.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};e=function(){function e(){}e.prototype.initialize=function(){return this.bindEvents()};e.prototype.bindEvents=function(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry)/)?document.addEventListener("deviceready",this.onDeviceReady,!1):this.onDeviceReady()};e.prototype.onDeviceReady=function(){var e;new FastClick(document.body);window.allRecipes=new a;e=new iScroll("full-page",{vScrollbar:!1,momentum:!1,bounce:!1});setTimeout(function(){return navigator.splashscreen.hide()},2e3);this.panel=new t;$("#app").append(this.panel.el);return window.allRecipes.fetch({success:function(){window.recipes=new a(window.allRecipes.models);return this.list=new n(window.recipes)},error:function(){}})};return e}();s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);return t}(Backbone.Model);a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.model=s;t.prototype.initialize=function(){return this.storage=new Offline.Storage("recipes",this)};t.prototype.url=function(){return"http://limitless-dawn-7700.herokuapp.com/recipes.json"};t.prototype.search=function(e){var t,n=this;t=this.filter(function(t){var n,r;r=e.toLowerCase();n=t.get("name").toLowerCase();return n.indexOf(r)!==-1});return t};return t}(Backbone.Collection);t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.id="bottom-panel";t.prototype.initialize=function(){return this.render()};t.prototype.render=function(e){var t;t=Handlebars.compile($("#bottom-panel-template").html());this.$el.html(t());return this};t.prototype.events={"click .expand":"expand","keyup input":"search","click .left":"left","click .right":"right","touchstart div":"tapped","touchend div":"untapped"};t.prototype.tapped=function(e){return $(e.target).addClass("tapped")};t.prototype.untapped=function(e){return $(e.target).removeClass("tapped")};t.prototype.expand=function(){return this.$el.toggleClass("active")};t.prototype.search=function(){var e,t;t=this.$("input").val();window.searchRecipes=new a(window.recipes.search(t));return e=new n({collection:window.searchRecipes})};t.prototype.left=function(){var e;this.$el.removeClass("active");typeof window.currentRecipe=="undefined"?e=_.last(window.allRecipes.models):window.recipes.at(window.currentRecipe-1)?e=window.recipes.at(window.currentRecipe-1):e=_.last(window.allRecipes.models);return(new i({model:e})).render()};t.prototype.right=function(){var e;this.$el.removeClass("active");typeof window.currentRecipe=="undefined"?e=_.first(window.allRecipes.models):e=window.recipes.at(window.currentRecipe+1);return(new i({model:e})).render()};return t}(Backbone.View);n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.el="#recipe-list";t.prototype.initialize=function(){var e;this.render();return e=new iScroll("recipe-list-wrapper",{vScroll:!1,hScroll:!0,snap:".recipe-pane",snapThreshold:100,momentum:!1,hScrollbar:!1,onScrollEnd:function(){var e;e=this.x/$(".recipe-pane").width();return $(".progress-circle").removeClass("active").eq(-e).addClass("active")}})};t.prototype.render=function(){var e,t,n,r;this.$el.html("");$(window).width()<400?e=6:e=8;console.log(this.collection);this.collection?n=this.collection:n=window.recipes;r=new a(n.models);while(r.length>0){t=new o({collection:r.first(e)});$("#recipe-list").append(t.render());r=new a(r.rest(e))}$("#recipe-list").width($(".recipe-pane").width()*$(".recipe-pane").length);$("#recipe-panel-progress").html("");_.each($(".recipe-pane"),function(e){return $("#recipe-panel-progress").append($("<div/>").addClass("progress-circle"))});$("#recipe-panel-progress .progress-circle").first().addClass("active");return this};return t}(Backbone.View);o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.tagName="ul";t.prototype.className="recipe-pane";t.prototype.render=function(){var e=this;_.each(this.collection,function(t){return e.$el.append((new u({model:t})).render())});return this.$el};return t}(Backbone.View);u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.tagName="li";t.prototype.render=function(){var e;e=Handlebars.compile($("#recipe-template").html());this.$el.html(e(this.model.toJSON()));return this.$el};t.prototype.events={click:"show",touchstart:"tapped",touchend:"untapped"};t.prototype.tapped=function(){return this.$el.addClass("tapped")};t.prototype.untapped=function(){return this.$el.removeClass("tapped")};t.prototype.show=function(){$("#bottom-panel").removeClass("active");if(typeof window.mainScroll=="undefined"){$("#full-page").html('<div class="recipe-wrapper"/>');(new r).render(window.recipes.indexOf(this.model))}else window.mainScroll.scrollToElement($(".recipe").get(window.recipes.indexOf(this.model)),0);return $(window.scrollers).each(function(){return this.scrollTo(0,0)})};return t}(Backbone.View);r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.el=".recipe-wrapper";t.prototype.render=function(e){var t,n,r=this;t=Handlebars.compile($("#full-recipe-template").html());window.scrollers=new Array;$(window).width()<400?n=100:n=200;window.recipes.each(function(e){var t,n;n=new i({model:e});t=n.render();r.$el.append(t);r.scroll=new iScroll(t,{vScroll:!0,vScrollbar:!1,hScroll:!1,hScrollbar:!1,lockDirection:!0});n.scroll=r.scroll;return window.scrollers.push(r.scroll)});window.mainScroll=new iScroll("full-page",{vScrollbar:!1,hScroll:!0,vScroll:!1,hScrollbar:!1,snap:".recipe",snapThreshold:n,momentum:!1,lockDirection:!0,onScrollEnd:function(){if(this.absDistX>n)return $(window.scrollers).each(function(){return this.scrollTo(0,0)})}});return window.mainScroll.scrollToElement($(".recipe").get(e),0)};return t}(Backbone.View);i=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.className="recipe";t.prototype.render=function(){var e;e=Handlebars.compile($("#full-recipe-template").html());this.$el.html(e(this.model.toJSON()));return this.el};t.prototype.events={"click .down":"down","touchstart .down":"tapped","touchend .down":"untapped",click:"hidepanel"};t.prototype.hidepanel=function(){if($("#bottom-panel").hasClass("active"))return $("#bottom-panel").removeClass("active")};t.prototype.tapped=function(){return this.$(".down").addClass("tapped")};t.prototype.untapped=function(){return this.$(".down").removeClass("tapped")};t.prototype.down=function(){var e;$(window).width()<400?e=-420:e=-880;return this.scroll.scrollTo(0,e,500)};return t}(Backbone.View);window.app=new e;window.app.initialize();setInterval();Handlebars.registerHelper("nl2br",function(e){var t;t=(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2");return new Handlebars.SafeString(t)})}).call(this);